# PROJECT.md — Полное описание проекта nerka.pro

> Этот документ предназначен для ИИ-агента, продолжающего работу над проектом.
> Здесь описана вся логика, структура, форматы, мотивации и ограничения.

## Суть проекта

**nerka.pro** — коммерческий B2B сайт-каталог оптовой продажи морепродуктов, снеков и закусок к пиву. Регион — Хабаровск и Дальний Восток. Заказ через WhatsApp/телефон. Минимальный заказ от 10 000 ₽.

Владелец: физлицо, работает один. Сайт нужен прежде всего как витрина для оптовых покупателей (HoReCa, розничные сети, мелкий опт).

## Стек и архитектура

- **Next.js 16** (React 19) со статическим экспортом (`output: 'export'`)
- **Чистый CSS** (без Tailwind, без CSS-in-JS) — осознанный выбор ради совместимости со старыми браузерами и простоты
- **GitHub Pages** — хостинг (бесплатный, статический, через GitHub Actions)
- **Домен**: nerka.pro (CNAME → GitHub Pages)
- Нет серверной части, нет базы данных, нет API. Вся логика на клиенте.

### Почему так

- Tailwind v4 был убран, потому что ломал рендер в старых Safari/мобилках. Чистый CSS работает везде.
- Статический экспорт потому что GitHub Pages не поддерживает SSR.
- React оставлен "на вырост" — для будущей корзины, поиска, фильтров.

## Структура файлов

```
app/
  layout.tsx     — корневой layout: <header>, <main>, <footer>
  page.tsx       — весь каталог: данные 163 товаров + компонент Catalog
  globals.css    — все стили сайта (один файл)

public/
  CNAME          — домен nerka.pro для GitHub Pages
  .nojekyll      — чтобы GitHub Pages не игнорировал _next/
  images/products/
    micro/       — 32×32 WebP, ~0.6KB средн. (blur-placeholder)
    thumb/       — 120×120 WebP, ~3.6KB средн. (карточка в списке)
    full/        — 400×400 WebP, ~15KB средн. (модалка детальной карточки)
    fallback/    — 400×400 JPEG, ~25KB средн. (совместимость: iPhone 5, iOS <14)
    raw/         — оригиналы из Wikimedia (gitignored, нужны только для перегенерации)

scripts/
  fetch_images.py     — скачивание фото из Wikimedia Commons API по ключевым словам
  gen_page.py         — генерация page.tsx из текущих данных + маппинг фото-групп
  process_images.py   — генерация 4 размеров из raw/ оригиналов (PIL)

.github/workflows/
  deploy.yml    — CI/CD: npm ci → build → deploy на GitHub Pages
```

## Данные каталога

163 товара, 7 категорий: Морепродукты, Закуски, Орехи и сухари, Мясо вяленое, Сыр, Цех, Икра.

Каждый товар:
```
{
  id: number,          — уникальный ID
  name: string,        — название товара
  price: string,       — цена (формат "1 234", пробел-разделитель тысяч)
  unit: "кг" | "шт",   — единица измерения
  stock: number,       — остаток на складе
  category: string,    — одна из 7 категорий
  color: string,       — цвет категории (hex) — сейчас не используется визуально
  image: string,       — slug фото-группы → 4 файла в images/products/
}
```

Данные захардкожены в `app/page.tsx` (массив `products`). Источник — Excel-файл прайс-листа, парсится через `scripts/gen_page.py`.

### Фильтрация по наличию

Товары с `stock: 0` НЕ включаются в каталог (отфильтрованы на этапе генерации page.tsx из Excel). Все товары в каталоге есть в наличии.

## Фотографии

### Концепция фото-групп

163 товара → 30 уникальных фото-групп. Многие товары визуально идентичны (вкусовые варианты одного продукта), поэтому делят одну фотографию. Примеры:
- 14 видов "Арахис глазурь X" → одно фото `glazed-peanuts`
- 8 видов "Лавашик X" → одно фото `lavash-chips`
- 8 видов "Сухари X" → одно фото `bread-crackers`

### 4 размера на slug

Каждый slug имеет 4 файла в разных папках:

| Папка      | Формат | Размер    | Вес     | Назначение                        |
|------------|--------|-----------|---------|-----------------------------------|
| micro/     | WebP   | 32×32     | ~0.6KB  | Blur-placeholder (мгновенная)     |
| thumb/     | WebP   | 120×120   | ~3.6KB  | Карточка товара в списке          |
| full/      | WebP   | 400×400   | ~15KB   | Модалка детальной карточки        |
| fallback/  | JPEG   | 400×400   | ~25KB   | Совместимость (старые браузеры)   |

### Обработка фото

- Оригинал кропается до квадрата (из центра)
- Размещается на тёмном фоне #0a0a0a (цвет --bg сайта) с отступом 15%
- WebP сохраняется с бинарным поиском quality для попадания в бюджет KB
- JPEG с optimize=True

### Совместимость (fallback)

В HTML используется `<picture>`:
```html
<picture>
  <source srcSet="/images/products/thumb/slug.webp" type="image/webp" />
  <img src="/images/products/fallback/slug.jpg" ... />
</picture>
```
Современные браузеры берут WebP. iPhone 5 (iOS 10, Safari без WebP) берёт JPEG из `<img>`.

### Источник фото

Wikimedia Commons API (свободные изображения, лицензия CC). Скрипт `fetch_images.py` ищет по английским ключевым словам, скачивает первое подходящее (>200×200px).

## UI/UX

### Общий стиль
- Тёмная тема (#0a0a0a фон, #111 карточки)
- Акцентный цвет: #e50019 (красный)
- Системный шрифт (без подключения внешних)
- Минималистичный B2B-дизайн

### Компоненты

**Header** (sticky):
- Логотип "nerka.pro" (font-weight: 400, regular)
- Навигация: Каталог, Доставка, Контакты (скрыта на мобилке)
- Телефон +7 924 403-42-03 (кликабельный)

**Hero**: заголовок + подзаголовок

**Фильтры категорий**: горизонтальные chip-кнопки. Интерактивные (React useState). "Все" показывает всё.

**Карточка товара** (в списке):
- Горизонтальная, высота 72px
- Фото 72×72 слева (thumb, <picture> с fallback)
- Название, цена, единица, кнопки +/- количества
- Бейдж "Мало" если stock ≤ 5
- Кликабельная → открывает модалку

**Модалка детальной карточки**:
- Фото full-size (400×400, <picture> с fallback)
- Категория, название, цена крупно
- "Осталось мало" если stock ≤ 5
- Кнопки количества
- Кнопка "Заказать в WhatsApp" (ссылка на wa.me)
- Закрытие: клик на overlay, кнопка ×

**Footer**: логотип, контакты (телефон, WhatsApp), инфо о доставке, копирайт.

### Адаптивность

- Mobile-first (1 колонка)
- 640px+: 2 колонки
- 768px+: навигация видна, hero крупнее
- 1024px+: 2 колонки
- 1280px+: 3 колонки

### Производительность

- Весь CSS в одном файле (~280 строк)
- Все фото с `loading="lazy"` и `decoding="async"`
- Нет внешних шрифтов, нет иконочных библиотек
- Суммарный вес фото: ~1.3MB на 120 файлов (30 slugs × 4 размера)
- Рассчитано на работу через EDGE (2G) соединение

## Будущие планы (не реализовано)

- Интерактивные кнопки количества (сейчас визуальные заглушки)
- Корзина и суммирование заказа
- Поиск по каталогу
- Обновление данных из Excel через CI (сейчас вручную через скрипт)
- Возможно: Telegram-бот для приёма заказов

## Контакты бизнеса

- Телефон: +7 924 403-42-03
- WhatsApp: wa.me/79244034203
- Домен: nerka.pro
- GitHub: github.com/crptnck/nerka
